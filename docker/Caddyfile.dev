

:80 {

  log {
    output stdout
    format console
    level INFO
  }

# 1. Static from vault:
handle_path /media/* {
    root * /vault
    file_server
}

# 2. Backend API:
handle_path /api/* {
    reverse_proxy admin-backend:8000
}

# 3. Frontend ( dev server or static http in container):
handle {
    reverse_proxy frontend:3000
}

# (optional) useful cache headers for images:
@images path_regexp img ^/media/arts/(previews|fullsize)/.*\.(avif|webp|jpe?g|png)$
header @images Cache-Control "public, max-age=31536000, immutable"
}
